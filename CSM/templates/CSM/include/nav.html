{% load static %}

<audio id="notification_new_message" src="{% static 'audio/newmessage.wav' %}" preload="auto"></audio>
<nav
  class="relative flex w-full flex-wrap items-center justify-between bg-[#FBFBFB] py-2 text-neutral-500 shadow-lg hover:text-neutral-700 focus:text-neutral-700 dark:bg-neutral-600 lg:py-4"
>
  <div class="flex w-full flex-wrap items-center justify-between px-3">
    <!-- Left elements -->
    <div class="flex mr-[15%]">
      <!-- Brand -->
      <a
        class="mx-2 my-1 flex items-center text-neutral-900 hover:text-neutral-900 focus:text-neutral-900 lg:mb-0 lg:mt-0"
        href="/"
      >
        <img
          class="mr-2"
          src="{% static 'favicon.png' %}"
          style="height: 30px"
          alt="CSM Logo"
          loading="lazy"
        />
      </a>
    </div>
    <!-- Left elements -->

    <!-- Center elements -->
    <ul class="list-style-none mx-auto flex-row pl-0 flex">
      <li class="px-2">
        <a
          class="text-neutral-500 transition text-2xl duration-200 hover:text-neutral-700 hover:ease-in-out focus:text-neutral-700 disabled:text-black/30 dark:text-neutral-200 dark:hover:text-neutral-300 dark:focus:text-neutral-300 [&.active]:text-black/90 dark:[&.active]:text-neutral-400 motion-reduce:transition-none"
          href="/">
          <i class="fa-solid fa-house"></i>
          <!-- Notification counter -->
          <span
            class="absolute -ml-4 -mt-3 rounded-full px-[0.50em] py-[0.25em] text-[1.2rem] font-bold leading-none text-red-800 notificationCounter hidden"
            >0</span
          >
        </a>
      </li>

      <li class="relative px-2">
        <!-- First dropdown trigger -->
        <a
          class="text-neutral-500 transition text-2xl duration-200 hover:text-neutral-700 hover:ease-in-out focus:text-neutral-700 disabled:text-black/30 dark:text-neutral-200 dark:hover:text-neutral-300 dark:focus:text-neutral-300 [&.active]:text-black/90 dark:[&.active]:text-neutral-400 motion-reduce:transition-none"
          href="{% url 'CSM:Send_Message' %}"
          id="dropdownMenuButton1"
          role="button"
        >
          <i class="fa-solid fa-comment"></i>
        </a>
      </li>

      <li class="px-2">
        <a
          class="text-neutral-500 transition text-2xl duration-200 hover:text-neutral-700 hover:ease-in-out focus:text-neutral-700 disabled:text-black/30 dark:text-neutral-200 dark:hover:text-neutral-300 dark:focus:text-neutral-300 [&.active]:text-black/90 dark:[&.active]:text-neutral-400 motion-reduce:transition-none"
          href="{% url 'CSM:inbox' %}">
          <i class="fa-solid fa-inbox"></i>
        </a>
      </li>

      <li class="px-2">
        <a
          class="text-neutral-500 transition text-2xl duration-200 hover:text-neutral-700 hover:ease-in-out focus:text-neutral-700 disabled:text-black/30 dark:text-neutral-200 dark:hover:text-neutral-300 dark:focus:text-neutral-300 [&.active]:text-black/90 dark:[&.active]:text-neutral-400 motion-reduce:transition-none"
          href="{% url 'CSM:AllProfiles' %}">
          <i class="fa-solid fa-people-group"></i>
        </a>
      </li>
    </ul>
    <!-- Center elements -->

    <!-- Right elements -->
    <ul class="list-style-none ml-auto flex flex-row pl-0 md:pl-4">
      <li class="px-2">
        <a
          class="text-neutral-500 transition duration-200 hover:text-neutral-700 hover:ease-in-out focus:text-neutral-700 disabled:text-black/30 dark:text-neutral-200 dark:hover:text-neutral-300 dark:focus:text-neutral-300 sm:flex [&.active]:text-black/90 dark:[&.active]:text-zinc-400 motion-reduce:transition-none"
          href="/{{ request.user.username }}"
          ><img
            src="{{request.user.employee.profile_pic.url}}"
            class="rounded-full"
            style="height: 25px; width: 25px"
            alt="TE Avatar"
            loading="lazy"
          />
          <strong class="ml-1 hidden sm:block">{{ user.username }}</strong>
        </a>
      </li>

      <li class="relative px-2">
        <!-- Third dropdown trigger -->
        <a
          class="hidden-arrow mr flex items-center text-neutral-500 transition duration-200 hover:text-neutral-700 hover:ease-in-out focus:text-neutral-700 disabled:text-black/30 dark:text-neutral-200 dark:hover:text-neutral-300 dark:focus:text-neutral-300 [&.active]:text-black/90 dark:[&.active]:text-neutral-400 motion-reduce:transition-none"
          href="#"
          id="DownArrow"
          role="button"
        >
          <!-- Dropdown trigger icon -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
            class="h-7 w-7"
          >
            <path
              fill-rule="evenodd"
              d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
              clip-rule="evenodd"
            />
          </svg>
        </a>
        <!-- Dropdown menu -->
        <ul
          class="absolute right-[15px] top-[45px] z-[1000] float-left hidden min-w-max list-none overflow-hidden rounded-lg border-none bg-white bg-clip-padding text-left text-base shadow-lg dark:bg-neutral-700"
          id="ul_nav"
        >
          <!-- Dropdown menu items -->
          <li>
            <a
              class="block w-full whitespace-nowrap bg-transparent px-4 py-2 text-sm font-normal text-neutral-700 hover:bg-neutral-100 active:text-neutral-800 active:no-underline disabled:pointer-events-none disabled:bg-transparent disabled:text-neutral-400 dark:text-neutral-200 dark:hover:bg-white/30"
              href="{% url 'CSM:Setting' %}"
              >Setting</a
            >
          </li>
          <li>
            <a
              class="block w-full whitespace-nowrap bg-transparent px-4 py-2 text-sm font-normal text-neutral-700 hover:bg-neutral-100 active:text-neutral-800 active:no-underline disabled:pointer-events-none disabled:bg-transparent disabled:text-neutral-400 dark:text-neutral-200 dark:hover:bg-white/30"
              href="{% url 'CSM:SignOut' %}"
              >Logout</a
            >
          </li>
        </ul>
      </li>
    </ul>
    <!-- Right elements -->
  </div>
</nav>

<script>
  $(document).ready(function () {


      setInterval(function(){
          if(parseInt($(".notificationCounter").text()) > 0){
              $('#notification_new_message')[0].play();
          }
      }, 15000);

      function fetchNewMessagesNotifications(){
          var employeeId = {{ request.user.id }}
          $.ajax({
              type    :"GET",
              url     : "{% url 'CSM:newMessagesNotification' %}",
              data    : {'employeeId' : employeeId},
              success : function (data){
                  if(data.notifications > 0){
                      $('.notificationCounter').html(data.notifications);
                      $('.notificationCounter').removeClass("hidden");
                  }else{
                      $('.notificationCounter').addClass("hidden");
                      $('.notificationCounter').html(0);                   
                  }
              },
              error   : function (xhr, status, error){
                  console.error('Error:', error);
              }
          });
      }
      setInterval(fetchNewMessagesNotifications, 2000);

  });


  var nav_dropDownMenu = document.getElementById("DownArrow");

  var downArrow = false;

  nav_dropDownMenu.addEventListener("click", function (){
      if(downArrow){
          var ul_nav = document.getElementById("ul_nav");
          ul_nav.classList.add("hidden");
          ul_nav.classList.add("overflow-hidden");
          downArrow = false;
      }else{
          var ul_nav = document.getElementById("ul_nav");
          ul_nav.classList.remove("hidden");
          ul_nav.classList.remove("overflow-hidden");
          downArrow = true;
      }

  });


</script>